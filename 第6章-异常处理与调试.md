# ç¬¬6ç« ï¼šå¼‚å¸¸å¤„ç†ä¸è°ƒè¯•

> "ç¨‹åºçš„å¥å£®æ€§ä¸åœ¨äºå®ƒä»ä¸å‡ºé”™ï¼Œè€Œåœ¨äºå®ƒçŸ¥é“å¦‚ä½•ä¼˜é›…åœ°å¤„ç†é”™è¯¯ã€‚"

## ğŸ“š æœ¬ç« å­¦ä¹ ç›®æ ‡

### ğŸ¯ çŸ¥è¯†ç›®æ ‡
- **ç†è§£å¼‚å¸¸çš„æœ¬è´¨**ï¼šæŒæ¡å¼‚å¸¸ã€é”™è¯¯ã€è°ƒè¯•çš„åŸºæœ¬æ¦‚å¿µ
- **æŒæ¡å¼‚å¸¸å¤„ç†è¯­æ³•**ï¼šç†Ÿç»ƒä½¿ç”¨try/except/else/finallyè¯­å¥
- **å­¦ä¼šè‡ªå®šä¹‰å¼‚å¸¸**ï¼šè®¾è®¡ç¬¦åˆä¸šåŠ¡éœ€æ±‚çš„å¼‚å¸¸ç±»ä½“ç³»
- **æŒæ¡è°ƒè¯•æŠ€èƒ½**ï¼šä½¿ç”¨å¤šç§è°ƒè¯•å·¥å…·å’ŒæŠ€æœ¯å®šä½é—®é¢˜
- **é…ç½®æ—¥å¿—ç³»ç»Ÿ**ï¼šå»ºç«‹å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œç›‘æ§æœºåˆ¶

### ğŸ› ï¸ æŠ€èƒ½ç›®æ ‡
- èƒ½å¤Ÿè¯†åˆ«å’Œå¤„ç†95%ä»¥ä¸Šçš„å¸¸è§å¼‚å¸¸æƒ…å†µ
- è®¾è®¡å¹¶å®ç°å®Œæ•´çš„è‡ªå®šä¹‰å¼‚å¸¸ä½“ç³»
- ç†Ÿç»ƒä½¿ç”¨pdbã€loggingç­‰è°ƒè¯•å·¥å…·
- ç¼–å†™å¥å£®ã€å¯ç»´æŠ¤çš„é”™è¯¯å¤„ç†ä»£ç 
- å»ºç«‹å®Œæ•´çš„ç¨‹åºè°ƒè¯•å’Œç›‘æ§ä½“ç³»

### ğŸŒŸ ç´ å…»ç›®æ ‡
- åŸ¹å…»**å®‰å…¨ç¼–ç¨‹æ€ç»´**ï¼šé¢„é˜²æ€§æ€è€ƒå¯èƒ½çš„é”™è¯¯æƒ…å†µ
- å»ºç«‹**è´¨é‡ä¿è¯æ„è¯†**ï¼šä¸»åŠ¨æµ‹è¯•å’ŒéªŒè¯ä»£ç å¥å£®æ€§  
- å½¢æˆ**ç³»ç»Ÿæ€§æ€ç»´**ï¼šä»æ•´ä½“è§’åº¦è®¾è®¡å¼‚å¸¸å¤„ç†ç­–ç•¥
- æŒæ¡**é—®é¢˜è§£å†³èƒ½åŠ›**ï¼šå¿«é€Ÿå®šä½å’Œä¿®å¤ç¨‹åºé—®é¢˜

## ğŸ—ºï¸ çŸ¥è¯†ä½“ç³»å¯¼å›¾

```mermaid
mindmap
  root((ç¬¬6ç« ï¼šå¼‚å¸¸å¤„ç†ä¸è°ƒè¯•))
    å¼‚å¸¸å¤„ç†åŸºç¡€
      å¼‚å¸¸æ¦‚å¿µ
        ä»€ä¹ˆæ˜¯å¼‚å¸¸
        å¼‚å¸¸vsé”™è¯¯
        å¼‚å¸¸å±‚æ¬¡ç»“æ„
      åŸºç¡€è¯­æ³•
        try-exceptè¯­å¥
        å¤šå¼‚å¸¸å¤„ç†
        elseå­å¥
        finallyå­å¥
      å†…ç½®å¼‚å¸¸
        å¸¸è§å¼‚å¸¸ç±»å‹
        å¼‚å¸¸å±æ€§å’Œæ–¹æ³•
        å¼‚å¸¸ä¿¡æ¯è·å–
    é«˜çº§å¼‚å¸¸å¤„ç†
      è‡ªå®šä¹‰å¼‚å¸¸
        å¼‚å¸¸ç±»è®¾è®¡åŸåˆ™
        å¼‚å¸¸ç»§æ‰¿ä½“ç³»
        å¼‚å¸¸å‚æ•°ä¼ é€’
      å¼‚å¸¸ä¼ æ’­
        è°ƒç”¨æ ˆæœºåˆ¶
        å¼‚å¸¸é‡æ–°æŠ›å‡º
        å¼‚å¸¸é“¾è¿½è¸ª
      æœ€ä½³å®è·µ
        å¼‚å¸¸å¤„ç†åŸåˆ™
        æ€§èƒ½è€ƒè™‘
        ä»£ç å¯è¯»æ€§
    è°ƒè¯•æŠ€æœ¯ä¸å·¥å…·
      è°ƒè¯•æ–¹æ³•è®º
        printè°ƒè¯•æ³•
        æ–­è¨€è°ƒè¯•
        äº¤äº’å¼è°ƒè¯•
      è°ƒè¯•å·¥å…·
        pdbè°ƒè¯•å™¨
        IDEé›†æˆè°ƒè¯•
        ç¬¬ä¸‰æ–¹è°ƒè¯•å·¥å…·
      è°ƒè¯•ç­–ç•¥
        é—®é¢˜å®šä½æŠ€å·§
        æµ‹è¯•ç”¨ä¾‹è®¾è®¡
        å›å½’æµ‹è¯•
    æ—¥å¿—ç³»ç»Ÿ
      loggingæ¨¡å—
        æ—¥å¿—çº§åˆ«ä½“ç³»
        æ—¥å¿—æ ¼å¼è®¾è®¡
        è¾“å‡ºç›®æ ‡é…ç½®
      é«˜çº§é…ç½®
        å¤šå¤„ç†å™¨é…ç½®
        æ ¼å¼åŒ–å™¨å®šåˆ¶
        è¿‡æ»¤å™¨ä½¿ç”¨
      ç”Ÿäº§åº”ç”¨
        æ€§èƒ½ç›‘æ§
        é”™è¯¯è¿½è¸ª
        è¿ç»´é›†æˆ
```

## 6.1 å¼‚å¸¸å¤„ç†åŸºç¡€ï¼šè®©ç¨‹åºå­¦ä¼š"ä¼˜é›…åœ°çŠ¯é”™"

### ğŸ¤” ä»€ä¹ˆæ˜¯å¼‚å¸¸ï¼Ÿ

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€è½¦å»ä¸€ä¸ªé‡è¦çš„ä¼šè®®ï¼š

```python
# ç”Ÿæ´»ä¸­çš„"å¼‚å¸¸"æƒ…å†µ
def drive_to_meeting():
    print("å¯åŠ¨æ±½è½¦...")
    print("æ£€æŸ¥ç‡ƒæ²¹...")
    # çªç„¶å‘ç°æ²¡æ²¹äº†ï¼è¿™å°±æ˜¯ä¸€ä¸ª"å¼‚å¸¸"æƒ…å†µ
    if fuel_level == 0:
        # å¦‚æœä¸å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œä½ å°±åˆ°ä¸äº†ä¼šè®®
        print("ç‡ƒæ²¹ä¸è¶³ï¼Œæ— æ³•ç»§ç»­è¡Œé©¶ï¼")
        return False
    
    print("æ­£å¸¸è¡Œé©¶åˆ°ç›®çš„åœ°")
    return True
```

åœ¨ç¼–ç¨‹ä¸­ï¼Œ**å¼‚å¸¸**å°±åƒå¼€è½¦æ—¶é‡åˆ°çš„æ„å¤–æƒ…å†µï¼š
- **æ­£å¸¸æµç¨‹**ï¼šä»£ç æŒ‰é¢„æœŸæ‰§è¡Œ
- **å¼‚å¸¸æƒ…å†µ**ï¼šé‡åˆ°æ„å¤–é—®é¢˜ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ã€ç½‘ç»œæ–­å¼€ã€æ•°æ®æ ¼å¼é”™è¯¯ç­‰ï¼‰
- **å¼‚å¸¸å¤„ç†**ï¼šé¢„å…ˆå‡†å¤‡å¥½çš„åº”å¯¹æ–¹æ¡ˆ

### ğŸ” å¼‚å¸¸ vs é”™è¯¯ï¼šä¸¤ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µ

è®©æˆ‘ä»¬é€šè¿‡ç”Ÿæ´»åŒ–çš„ä¾‹å­æ¥ç†è§£ï¼š

```python
# 1. è¯­æ³•é”™è¯¯ï¼ˆSyntax Errorï¼‰- ç›¸å½“äº"è¯´é”™è¯"
def greet_user()
    print("Hello")  # ç¼ºå°‘å†’å·ï¼Œè¿™æ˜¯è¯­æ³•é”™è¯¯
    # è¿™ç§é”™è¯¯ç¨‹åºæ ¹æœ¬è¿è¡Œä¸èµ·æ¥ï¼Œå°±åƒè¯´è¯è¯­æ³•ä¸é€š

# 2. é€»è¾‘é”™è¯¯ï¼ˆLogic Errorï¼‰- ç›¸å½“äº"åšé”™äº‹"
def calculate_age(birth_year):
    current_year = 2024
    age = birth_year - current_year  # é€»è¾‘é”™è¯¯ï¼šåº”è¯¥æ˜¯current_year - birth_year
    return age
    # ç¨‹åºèƒ½è¿è¡Œï¼Œä½†ç»“æœä¸å¯¹ï¼Œå°±åƒåšäº†ä¸€ä»¶çœ‹ä¼¼æ­£ç¡®ä½†å®é™…é”™è¯¯çš„äº‹

# 3. å¼‚å¸¸ï¼ˆExceptionï¼‰- ç›¸å½“äº"é‡åˆ°æ„å¤–"
def read_user_file(filename):
    # ç¨‹åºé€»è¾‘æ­£ç¡®ï¼Œä½†å¯èƒ½é‡åˆ°æ„å¤–æƒ…å†µ
    try:
        with open(filename, 'r') as file:
            content = file.read()
        return content
    except FileNotFoundError:
        # è¿™æ˜¯å¼‚å¸¸ï¼šæ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨ï¼Œè¿™ä¸æ˜¯ç¨‹åºå‘˜çš„é”™
        print(f"æ–‡ä»¶ {filename} ä¸å­˜åœ¨")
        return None
```

### ğŸŒ³ Pythonå¼‚å¸¸çš„å±‚æ¬¡ç»“æ„

Pythonçš„å¼‚å¸¸å°±åƒä¸€ä¸ªå®¶æ—æ ‘ï¼Œæ¯ä¸ªå¼‚å¸¸éƒ½æœ‰è‡ªå·±çš„"è¡€ç»Ÿå…³ç³»"ï¼š

```python
# Pythonå¼‚å¸¸å±‚æ¬¡ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰
"""
BaseException
 â”œâ”€â”€ SystemExit          # ç³»ç»Ÿé€€å‡º
 â”œâ”€â”€ KeyboardInterrupt   # é”®ç›˜ä¸­æ–­ï¼ˆCtrl+Cï¼‰
 â””â”€â”€ Exception           # æ‰€æœ‰å¸¸è§„å¼‚å¸¸çš„åŸºç±»
     â”œâ”€â”€ ArithmeticError     # ç®—æœ¯é”™è¯¯åŸºç±»
     â”‚   â”œâ”€â”€ ZeroDivisionError    # é™¤é›¶é”™è¯¯
     â”‚   â””â”€â”€ OverflowError        # æ•°å€¼æº¢å‡º
     â”œâ”€â”€ LookupError         # æŸ¥æ‰¾é”™è¯¯åŸºç±»
     â”‚   â”œâ”€â”€ IndexError           # ç´¢å¼•é”™è¯¯
     â”‚   â””â”€â”€ KeyError            # é”®é”™è¯¯
     â”œâ”€â”€ OSError             # æ“ä½œç³»ç»Ÿé”™è¯¯
     â”‚   â””â”€â”€ FileNotFoundError    # æ–‡ä»¶æœªæ‰¾åˆ°
     â”œâ”€â”€ ValueError          # å€¼é”™è¯¯
     â”œâ”€â”€ TypeError           # ç±»å‹é”™è¯¯
     â””â”€â”€ RuntimeError        # è¿è¡Œæ—¶é”™è¯¯
"""

# æ¼”ç¤ºå¼‚å¸¸ç»§æ‰¿å…³ç³»
def demonstrate_exception_hierarchy():
    """æ¼”ç¤ºå¼‚å¸¸çš„ç»§æ‰¿å…³ç³»"""
    
    # 1. æœ€å…·ä½“çš„å¼‚å¸¸å¤„ç†
    try:
        numbers = [1, 2, 3]
        print(numbers[10])  # ä¼šå¼•å‘IndexError
    except IndexError as e:
        print(f"ç´¢å¼•é”™è¯¯: {e}")
    
    # 2. è¾ƒé€šç”¨çš„å¼‚å¸¸å¤„ç†
    try:
        result = 10 / 0  # ä¼šå¼•å‘ZeroDivisionError
    except ArithmeticError as e:
        print(f"ç®—æœ¯é”™è¯¯: {e}")
    
    # 3. æœ€é€šç”¨çš„å¼‚å¸¸å¤„ç†
    try:
        undefined_variable
    except Exception as e:
        print(f"é€šç”¨å¼‚å¸¸: {e}")

# æµ‹è¯•å¼‚å¸¸å±‚æ¬¡
if __name__ == "__main__":
    demonstrate_exception_hierarchy()
```

### ğŸ”§ åŸºç¡€å¼‚å¸¸å¤„ç†è¯­æ³•

#### try-exceptï¼šå¼‚å¸¸å¤„ç†çš„åŸºæœ¬ç»“æ„

```python
# åŸºæœ¬çš„try-exceptç»“æ„
def safe_divide(a, b):
    """å®‰å…¨çš„é™¤æ³•è¿ç®—"""
    try:
        # å°è¯•æ‰§è¡Œå¯èƒ½å‡ºé”™çš„ä»£ç 
        result = a / b
        print(f"{a} Ã· {b} = {result}")
        return result
    except ZeroDivisionError:
        # å¤„ç†ç‰¹å®šçš„å¼‚å¸¸
        print("é”™è¯¯ï¼šä¸èƒ½é™¤ä»¥é›¶ï¼")
        return None

# æµ‹è¯•å®‰å…¨é™¤æ³•
print("=== å®‰å…¨é™¤æ³•æµ‹è¯• ===")
safe_divide(10, 2)   # æ­£å¸¸æƒ…å†µ
safe_divide(10, 0)   # å¼‚å¸¸æƒ…å†µ
```

#### å¤„ç†å¤šç§å¼‚å¸¸ï¼šä¸€æ¬¡æ€§æ•è·ä¸åŒç±»å‹çš„é”™è¯¯

```python
def process_user_input():
    """å¤„ç†ç”¨æˆ·è¾“å…¥çš„å¤šç§å¼‚å¸¸æƒ…å†µ"""
    
    try:
        # è·å–ç”¨æˆ·è¾“å…¥
        user_input = input("è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—: ")
        
        # è½¬æ¢ä¸ºæ•°å­—
        number = float(user_input)
        
        # è¿›è¡Œè®¡ç®—
        result = 100 / number
        
        print(f"100 é™¤ä»¥ {number} ç­‰äº {result}")
        
    except ValueError:
        # å¤„ç†æ— æ³•è½¬æ¢ä¸ºæ•°å­—çš„æƒ…å†µ
        print("é”™è¯¯ï¼šè¾“å…¥çš„ä¸æ˜¯æœ‰æ•ˆæ•°å­—ï¼")
        
    except ZeroDivisionError:
        # å¤„ç†é™¤é›¶é”™è¯¯
        print("é”™è¯¯ï¼šä¸èƒ½è¾“å…¥é›¶ï¼")
        
    except KeyboardInterrupt:
        # å¤„ç†ç”¨æˆ·æŒ‰Ctrl+Cçš„æƒ…å†µ
        print("\nç¨‹åºè¢«ç”¨æˆ·ä¸­æ–­")
        
    except Exception as e:
        # å¤„ç†å…¶ä»–æ‰€æœ‰å¼‚å¸¸
        print(f"å‘ç”Ÿäº†æœªçŸ¥é”™è¯¯: {e}")

# å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªexceptè¯­å¥å¤„ç†å¤šç§å¼‚å¸¸
def simplified_input_processor():
    """ç®€åŒ–çš„å¤šå¼‚å¸¸å¤„ç†"""
    
    try:
        user_input = input("è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—: ")
        number = float(user_input)
        result = 100 / number
        print(f"100 é™¤ä»¥ {number} ç­‰äº {result}")
        
    except (ValueError, ZeroDivisionError) as e:
        # åŒæ—¶å¤„ç†å¤šç§å¼‚å¸¸
        print(f"è¾“å…¥é”™è¯¯: {e}")
        
    except Exception as e:
        print(f"å…¶ä»–é”™è¯¯: {e}")

# æ¼”ç¤ºä¸åŒçš„å¼‚å¸¸å¤„ç†æ–¹å¼
if __name__ == "__main__":
    print("=== å¤šå¼‚å¸¸å¤„ç†æ¼”ç¤º ===")
    # process_user_input()  # å¯ä»¥å–æ¶ˆæ³¨é‡Šæµ‹è¯•
```

#### elseå­å¥ï¼šåªåœ¨æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œ

```python
def file_statistics(filename):
    """ç»Ÿè®¡æ–‡ä»¶ä¿¡æ¯ï¼Œæ¼”ç¤ºelseå­å¥çš„ä½¿ç”¨"""
    
    try:
        # å°è¯•æ‰“å¼€æ–‡ä»¶
        with open(filename, 'r', encoding='utf-8') as file:
            content = file.read()
            
    except FileNotFoundError:
        print(f"æ–‡ä»¶ {filename} ä¸å­˜åœ¨")
        return None
        
    except PermissionError:
        print(f"æ²¡æœ‰æƒé™è¯»å–æ–‡ä»¶ {filename}")
        return None
        
    else:
        # åªæœ‰åœ¨æ²¡æœ‰å¼‚å¸¸æ—¶æ‰æ‰§è¡Œ
        print("æ–‡ä»¶è¯»å–æˆåŠŸï¼")
        
        # ç»Ÿè®¡æ–‡ä»¶ä¿¡æ¯
        lines = content.split('\n')
        words = content.split()
        characters = len(content)
        
        stats = {
            'lines': len(lines),
            'words': len(words), 
            'characters': characters
        }
        
        print(f"æ–‡ä»¶ç»Ÿè®¡: {stats}")
        return stats

# åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¹¶æµ‹è¯•
def create_test_file():
    """åˆ›å»ºæµ‹è¯•æ–‡ä»¶"""
    test_content = """Pythonå¼‚å¸¸å¤„ç†
æ˜¯ç¨‹åºå¥å£®æ€§çš„é‡è¦ä¿è¯
è®©æˆ‘ä»¬å­¦ä¼šä¼˜é›…åœ°å¤„ç†é”™è¯¯"""
    
    with open('test_file.txt', 'w', encoding='utf-8') as f:
        f.write(test_content)

# æµ‹è¯•elseå­å¥
if __name__ == "__main__":
    print("=== elseå­å¥æ¼”ç¤º ===")
    create_test_file()
    file_statistics('test_file.txt')      # æ–‡ä»¶å­˜åœ¨
    file_statistics('nonexistent.txt')   # æ–‡ä»¶ä¸å­˜åœ¨
```

#### finallyå­å¥ï¼šæ— è®ºå¦‚ä½•éƒ½è¦æ‰§è¡Œçš„ä»£ç 

```python
import time

def database_operation():
    """æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œï¼Œæ¼”ç¤ºfinallyå­å¥"""
    
    connection = None
    
    try:
        print("è¿æ¥æ•°æ®åº“...")
        connection = "database_connection"  # æ¨¡æ‹Ÿè¿æ¥
        
        print("æ‰§è¡Œæ•°æ®åº“æ“ä½œ...")
        time.sleep(1)  # æ¨¡æ‹Ÿæ“ä½œè€—æ—¶
        
        # æ¨¡æ‹Ÿå¯èƒ½çš„å¼‚å¸¸
        import random
        if random.choice([True, False]):
            raise Exception("æ•°æ®åº“æ“ä½œå¤±è´¥ï¼")
            
        print("æ•°æ®åº“æ“ä½œæˆåŠŸå®Œæˆ")
        return True
        
    except Exception as e:
        print(f"æ•°æ®åº“æ“ä½œå¼‚å¸¸: {e}")
        return False
        
    else:
        print("æ•°æ®åº“æ“ä½œæ­£å¸¸ç»“æŸ")
        
    finally:
        # æ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸ï¼Œéƒ½è¦æ‰§è¡Œæ¸…ç†å·¥ä½œ
        if connection:
            print("å…³é—­æ•°æ®åº“è¿æ¥...")
            connection = None
        print("èµ„æºæ¸…ç†å®Œæˆ")

# å®Œæ•´çš„try-except-else-finallyç¤ºä¾‹
def complete_exception_handling():
    """å®Œæ•´çš„å¼‚å¸¸å¤„ç†ç»“æ„æ¼”ç¤º"""
    
    print("=== å®Œæ•´å¼‚å¸¸å¤„ç†æ¼”ç¤º ===")
    
    try:
        print("1. å¼€å§‹æ‰§è¡Œtryå—")
        result = 10 / 2
        print(f"2. è®¡ç®—ç»“æœ: {result}")
        
    except ZeroDivisionError:
        print("3. å¤„ç†é™¤é›¶å¼‚å¸¸")
        
    except Exception as e:
        print(f"3. å¤„ç†å…¶ä»–å¼‚å¸¸: {e}")
        
    else:
        print("4. æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œelseå—")
        
    finally:
        print("5. æ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œfinallyå—")

# æµ‹è¯•å®Œæ•´å¼‚å¸¸å¤„ç†
if __name__ == "__main__":
    print("=== finallyå­å¥æ¼”ç¤º ===")
    database_operation()
    print()
    complete_exception_handling()
```

### ğŸ“‹ å¸¸è§å†…ç½®å¼‚å¸¸ç±»å‹

Pythonæä¾›äº†ä¸°å¯Œçš„å†…ç½®å¼‚å¸¸ç±»å‹ï¼Œè®©æˆ‘ä»¬é€ä¸€äº†è§£ï¼š

```python
def common_exceptions_demo():
    """æ¼”ç¤ºå¸¸è§å¼‚å¸¸ç±»å‹"""
    
    # 1. ValueErrorï¼šå€¼é”™è¯¯
    print("=== ValueError æ¼”ç¤º ===")
    try:
        number = int("abc")  # æ— æ³•è½¬æ¢çš„å­—ç¬¦ä¸²
    except ValueError as e:
        print(f"ValueError: {e}")
    
    # 2. TypeErrorï¼šç±»å‹é”™è¯¯
    print("\n=== TypeError æ¼”ç¤º ===")
    try:
        result = "hello" + 5  # å­—ç¬¦ä¸²ä¸èƒ½å’Œæ•°å­—ç›¸åŠ 
    except TypeError as e:
        print(f"TypeError: {e}")
    
    # 3. IndexErrorï¼šç´¢å¼•é”™è¯¯
    print("\n=== IndexError æ¼”ç¤º ===")
    try:
        my_list = [1, 2, 3]
        print(my_list[10])  # ç´¢å¼•è¶…å‡ºèŒƒå›´
    except IndexError as e:
        print(f"IndexError: {e}")
    
    # 4. KeyErrorï¼šé”®é”™è¯¯
    print("\n=== KeyError æ¼”ç¤º ===")
    try:
        my_dict = {"name": "Alice", "age": 25}
        print(my_dict["height"])  # é”®ä¸å­˜åœ¨
    except KeyError as e:
        print(f"KeyError: {e}")
    
    # 5. AttributeErrorï¼šå±æ€§é”™è¯¯
    print("\n=== AttributeError æ¼”ç¤º ===")
    try:
        my_string = "hello"
        my_string.append("world")  # å­—ç¬¦ä¸²æ²¡æœ‰appendæ–¹æ³•
    except AttributeError as e:
        print(f"AttributeError: {e}")
    
    # 6. FileNotFoundErrorï¼šæ–‡ä»¶æœªæ‰¾åˆ°
    print("\n=== FileNotFoundError æ¼”ç¤º ===")
    try:
        with open("nonexistent_file.txt", "r") as f:
            content = f.read()
    except FileNotFoundError as e:
        print(f"FileNotFoundError: {e}")
    
    # 7. ZeroDivisionErrorï¼šé™¤é›¶é”™è¯¯
    print("\n=== ZeroDivisionError æ¼”ç¤º ===")
    try:
        result = 10 / 0
    except ZeroDivisionError as e:
        print(f"ZeroDivisionError: {e}")

# æµ‹è¯•å¸¸è§å¼‚å¸¸
if __name__ == "__main__":
    common_exceptions_demo()
```

### ğŸ¯ ç»ƒä¹ é¢˜ï¼šåŸºç¡€å¼‚å¸¸å¤„ç†

```python
# ç»ƒä¹ 1ï¼šå®‰å…¨çš„ç”¨æˆ·è¾“å…¥å¤„ç†
def safe_input_processor():
    """
    ç»ƒä¹ 1ï¼šç¼–å†™ä¸€ä¸ªå®‰å…¨çš„ç”¨æˆ·è¾“å…¥å¤„ç†å‡½æ•°
    
    è¦æ±‚ï¼š
    1. æç¤ºç”¨æˆ·è¾“å…¥ä¸¤ä¸ªæ•°å­—
    2. è¿›è¡Œå››åˆ™è¿ç®—ï¼ˆåŠ å‡ä¹˜é™¤ï¼‰
    3. å¤„ç†æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸æƒ…å†µ
    4. ç»™å‡ºå‹å¥½çš„é”™è¯¯æç¤º
    """
    
    try:
        # è·å–ç¬¬ä¸€ä¸ªæ•°å­—
        num1_str = input("è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—: ")
        num1 = float(num1_str)
        
        # è·å–ç¬¬äºŒä¸ªæ•°å­—
        num2_str = input("è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—: ")
        num2 = float(num2_str)
        
        # è·å–è¿ç®—ç¬¦
        operator = input("è¯·è¾“å…¥è¿ç®—ç¬¦ (+, -, *, /): ")
        
        # è¿›è¡Œè®¡ç®—
        if operator == '+':
            result = num1 + num2
        elif operator == '-':
            result = num1 - num2
        elif operator == '*':
            result = num1 * num2
        elif operator == '/':
            result = num1 / num2
        else:
            raise ValueError("ä¸æ”¯æŒçš„è¿ç®—ç¬¦")
        
        print(f"è®¡ç®—ç»“æœ: {num1} {operator} {num2} = {result}")
        
    except ValueError as e:
        if "ä¸æ”¯æŒçš„è¿ç®—ç¬¦" in str(e):
            print("é”™è¯¯ï¼šè¯·è¾“å…¥æœ‰æ•ˆçš„è¿ç®—ç¬¦ (+, -, *, /)")
        else:
            print("é”™è¯¯ï¼šè¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—")
    except ZeroDivisionError:
        print("é”™è¯¯ï¼šä¸èƒ½é™¤ä»¥é›¶")
    except KeyboardInterrupt:
        print("\nç¨‹åºè¢«ç”¨æˆ·ä¸­æ–­")
    except Exception as e:
        print(f"å‘ç”ŸæœªçŸ¥é”™è¯¯: {e}")

# ç»ƒä¹ 2ï¼šæ–‡ä»¶æ“ä½œå¼‚å¸¸å¤„ç†
def safe_file_operations():
    """
    ç»ƒä¹ 2ï¼šå®‰å…¨çš„æ–‡ä»¶æ“ä½œ
    
    è¦æ±‚ï¼š
    1. è¯»å–ç”¨æˆ·æŒ‡å®šçš„æ–‡ä»¶
    2. ç»Ÿè®¡æ–‡ä»¶ä¸­çš„å•è¯æ•°é‡
    3. å°†ç»“æœå†™å…¥æ–°æ–‡ä»¶
    4. å¤„ç†å„ç§å¯èƒ½çš„æ–‡ä»¶æ“ä½œå¼‚å¸¸
    """
    
    try:
        # è·å–æ–‡ä»¶å
        filename = input("è¯·è¾“å…¥è¦è¯»å–çš„æ–‡ä»¶å: ")
        
        # è¯»å–æ–‡ä»¶
        with open(filename, 'r', encoding='utf-8') as file:
            content = file.read()
        
        # ç»Ÿè®¡å•è¯
        words = content.split()
        word_count = len(words)
        
        # å†™å…¥ç»“æœæ–‡ä»¶
        result_filename = f"{filename}_word_count.txt"
        with open(result_filename, 'w', encoding='utf-8') as result_file:
            result_file.write(f"æ–‡ä»¶ {filename} åŒ…å« {word_count} ä¸ªå•è¯")
        
        print(f"ç»Ÿè®¡å®Œæˆï¼ç»“æœå·²ä¿å­˜åˆ° {result_filename}")
        
    except FileNotFoundError:
        print(f"é”™è¯¯ï¼šæ–‡ä»¶ {filename} ä¸å­˜åœ¨")
    except PermissionError:
        print("é”™è¯¯ï¼šæ²¡æœ‰æƒé™è®¿é—®æ–‡ä»¶")
    except UnicodeDecodeError:
        print("é”™è¯¯ï¼šæ–‡ä»¶ç¼–ç æ ¼å¼ä¸æ”¯æŒ")
    except Exception as e:
        print(f"æ–‡ä»¶æ“ä½œå¤±è´¥: {e}")

# å¦‚æœè¦æµ‹è¯•ç»ƒä¹ ï¼Œå–æ¶ˆä¸‹é¢çš„æ³¨é‡Š
if __name__ == "__main__":
    print("=== å¼‚å¸¸å¤„ç†ç»ƒä¹  ===")
    # safe_input_processor()    # ç»ƒä¹ 1
    # safe_file_operations()    # ç»ƒä¹ 2
```

### ğŸ” æœ¬èŠ‚å°ç»“

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ï¼š

1. **å¼‚å¸¸çš„æ¦‚å¿µ**ï¼šç¨‹åºè¿è¡Œæ—¶é‡åˆ°çš„æ„å¤–æƒ…å†µ
2. **å¼‚å¸¸ vs é”™è¯¯**ï¼šè¯­æ³•é”™è¯¯ã€é€»è¾‘é”™è¯¯å’Œå¼‚å¸¸çš„åŒºåˆ«
3. **å¼‚å¸¸å±‚æ¬¡ç»“æ„**ï¼šPythonå¼‚å¸¸çš„ç»§æ‰¿å…³ç³»
4. **åŸºç¡€è¯­æ³•**ï¼štry/except/else/finallyçš„ä½¿ç”¨
5. **å¸¸è§å¼‚å¸¸ç±»å‹**ï¼šValueErrorã€TypeErrorã€IndexErrorç­‰

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- å¼‚å¸¸å¤„ç†è®©ç¨‹åºæ›´å¥å£®ï¼Œèƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†æ„å¤–æƒ…å†µ
- ä½¿ç”¨å…·ä½“çš„å¼‚å¸¸ç±»å‹è€Œä¸æ˜¯é€šç”¨çš„Exception
- elseå­å¥åœ¨æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œï¼Œfinallyå­å¥æ€»æ˜¯æ‰§è¡Œ
- è‰¯å¥½çš„å¼‚å¸¸å¤„ç†èƒ½æå‡ç”¨æˆ·ä½“éªŒ

ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ï¼Œè®¾è®¡ç¬¦åˆä¸šåŠ¡éœ€æ±‚çš„å¼‚å¸¸å¤„ç†ä½“ç³»ã€‚

---

> **æ€è€ƒé¢˜**ï¼šä¸ºä»€ä¹ˆè¦ç”¨å…·ä½“çš„å¼‚å¸¸ç±»å‹ï¼ˆå¦‚ValueErrorï¼‰è€Œä¸æ˜¯é€šç”¨çš„Exceptionï¼Ÿ
> 
> **ç­”æ¡ˆ**ï¼šä½¿ç”¨å…·ä½“å¼‚å¸¸ç±»å‹å¯ä»¥ï¼š1ï¼‰æä¾›æ›´ç²¾ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼›2ï¼‰å…è®¸ä¸åŒçš„å¤„ç†ç­–ç•¥ï¼›3ï¼‰é¿å…æ„å¤–æ•è·ä¸ç›¸å…³çš„å¼‚å¸¸ï¼›4ï¼‰æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚

## 6.2 è‡ªå®šä¹‰å¼‚å¸¸è®¾è®¡ï¼šæ‰“é€ ä¸“å±çš„é”™è¯¯å¤„ç†ä½“ç³»

### ğŸ—ï¸ ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å¼‚å¸¸ï¼Ÿ

æƒ³è±¡ä½ åœ¨å¼€å‘ä¸€ä¸ªé“¶è¡Œç³»ç»Ÿï¼Œç”¨æˆ·è¦è½¬è´¦æ—¶å¯èƒ½é‡åˆ°å„ç§é—®é¢˜ï¼š

```python
# ä½¿ç”¨å†…ç½®å¼‚å¸¸çš„é—®é¢˜
def transfer_money_basic(from_account, to_account, amount):
    """åŸºç¡€è½¬è´¦åŠŸèƒ½ï¼ˆä½¿ç”¨å†…ç½®å¼‚å¸¸çš„é—®é¢˜æ¼”ç¤ºï¼‰"""
    
    # é—®é¢˜1ï¼šå†…ç½®å¼‚å¸¸æ— æ³•è¡¨è¾¾ä¸šåŠ¡å«ä¹‰
    if amount <= 0:
        raise ValueError("è½¬è´¦é‡‘é¢å¿…é¡»å¤§äº0")  # å¤ªå®½æ³›
    
    # é—®é¢˜2ï¼šæ— æ³•åŒºåˆ†ä¸åŒçš„ä¸šåŠ¡é”™è¯¯  
    if from_account.balance < amount:
        raise ValueError("ä½™é¢ä¸è¶³")  # å’Œä¸Šé¢ç”¨åŒä¸€ä¸ªå¼‚å¸¸ç±»å‹
    
    # é—®é¢˜3ï¼šæ— æ³•æºå¸¦ä¸šåŠ¡ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯
    if not to_account.exists():
        raise ValueError("ç›®æ ‡è´¦æˆ·ä¸å­˜åœ¨")  # ç¼ºå°‘è´¦æˆ·å·ç ç­‰ä¿¡æ¯

# ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸çš„ä¼˜åŠ¿
class BankingError(Exception):
    """é“¶è¡Œä¸šåŠ¡å¼‚å¸¸åŸºç±»"""
    def __init__(self, message, error_code=None, details=None):
        super().__init__(message)
        self.error_code = error_code
        self.details = details or {}
        self.timestamp = time.time()

class InsufficientFundsError(BankingError):
    """ä½™é¢ä¸è¶³å¼‚å¸¸"""
    def __init__(self, account_id, current_balance, required_amount):
        message = f"è´¦æˆ· {account_id} ä½™é¢ä¸è¶³ï¼šå½“å‰ä½™é¢ {current_balance}ï¼Œéœ€è¦ {required_amount}"
        super().__init__(message, error_code="INSUFFICIENT_FUNDS")
        self.account_id = account_id
        self.current_balance = current_balance
        self.required_amount = required_amount

class AccountNotFoundError(BankingError):
    """è´¦æˆ·ä¸å­˜åœ¨å¼‚å¸¸"""
    def __init__(self, account_id):
        message = f"è´¦æˆ· {account_id} ä¸å­˜åœ¨"
        super().__init__(message, error_code="ACCOUNT_NOT_FOUND")
        self.account_id = account_id

def transfer_money_improved(from_account, to_account, amount):
    """æ”¹è¿›çš„è½¬è´¦åŠŸèƒ½ï¼ˆä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ï¼‰"""
    
    # æ¸…æ™°çš„ä¸šåŠ¡å¼‚å¸¸ç±»å‹
    if amount <= 0:
        raise ValueError("è½¬è´¦é‡‘é¢å¿…é¡»å¤§äº0")
    
    if from_account.balance < amount:
        raise InsufficientFundsError(
            from_account.id, 
            from_account.balance, 
            amount
        )
    
    if not to_account.exists():
        raise AccountNotFoundError(to_account.id)
```

### ğŸ¨ è‡ªå®šä¹‰å¼‚å¸¸è®¾è®¡åŸåˆ™

#### 1. ç»§æ‰¿åˆé€‚çš„åŸºç±»

```python
# åŸåˆ™1ï¼šé€‰æ‹©åˆé€‚çš„çˆ¶ç±»
class BusinessError(Exception):
    """ä¸šåŠ¡å¼‚å¸¸åŸºç±» - ç»§æ‰¿è‡ªException"""
    pass

class ValidationError(ValueError):
    """éªŒè¯å¼‚å¸¸ - ç»§æ‰¿è‡ªValueErroræ›´åˆé€‚"""
    pass

class NetworkError(ConnectionError):
    """ç½‘ç»œå¼‚å¸¸ - ç»§æ‰¿è‡ªConnectionError"""
    pass

# åŸåˆ™2ï¼šå»ºç«‹å¼‚å¸¸å±‚æ¬¡ç»“æ„
class ApplicationError(Exception):
    """åº”ç”¨ç¨‹åºå¼‚å¸¸åŸºç±»"""
    def __init__(self, message, error_code=None):
        super().__init__(message)
        self.error_code = error_code

class BusinessLogicError(ApplicationError):
    """ä¸šåŠ¡é€»è¾‘å¼‚å¸¸"""
    pass

class DataAccessError(ApplicationError):
    """æ•°æ®è®¿é—®å¼‚å¸¸"""
    pass

class UserAuthenticationError(BusinessLogicError):
    """ç”¨æˆ·è®¤è¯å¼‚å¸¸"""
    pass

class UserAuthorizationError(BusinessLogicError):
    """ç”¨æˆ·æˆæƒå¼‚å¸¸"""
    pass

class DatabaseConnectionError(DataAccessError):
    """æ•°æ®åº“è¿æ¥å¼‚å¸¸"""
    pass

class DataValidationError(DataAccessError):
    """æ•°æ®éªŒè¯å¼‚å¸¸"""
    pass
```

#### 2. æä¾›ä¸°å¯Œçš„å¼‚å¸¸ä¿¡æ¯

```python
import time
from datetime import datetime

class RichException(Exception):
    """ä¿¡æ¯ä¸°å¯Œçš„å¼‚å¸¸åŸºç±»"""
    
    def __init__(self, message, error_code=None, details=None, 
                 suggestions=None, timestamp=None):
        super().__init__(message)
        
        # åŸºæœ¬ä¿¡æ¯
        self.message = message
        self.error_code = error_code or "UNKNOWN_ERROR"
        
        # è¯¦ç»†ä¿¡æ¯
        self.details = details or {}
        self.suggestions = suggestions or []
        
        # æ—¶é—´ä¿¡æ¯
        self.timestamp = timestamp or time.time()
        self.datetime = datetime.fromtimestamp(self.timestamp)
    
    def to_dict(self):
        """è½¬æ¢ä¸ºå­—å…¸æ ¼å¼ï¼Œä¾¿äºæ—¥å¿—è®°å½•å’ŒAPIè¿”å›"""
        return {
            'error_code': self.error_code,
            'message': self.message,
            'details': self.details,
            'suggestions': self.suggestions,
            'timestamp': self.timestamp,
            'datetime': str(self.datetime)
        }
    
    def __str__(self):
        """å‹å¥½çš„å­—ç¬¦ä¸²è¡¨ç¤º"""
        base_msg = f"[{self.error_code}] {self.message}"
        
        if self.details:
            details_str = ", ".join([f"{k}={v}" for k, v in self.details.items()])
            base_msg += f" (è¯¦æƒ…: {details_str})"
        
        if self.suggestions:
            suggestions_str = "; ".join(self.suggestions)
            base_msg += f" (å»ºè®®: {suggestions_str})"
        
        return base_msg

# ä½¿ç”¨ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿå¼‚å¸¸
class ECommerceError(RichException):
    """ç”µå•†ç³»ç»Ÿå¼‚å¸¸åŸºç±»"""
    pass

class ProductNotFoundError(ECommerceError):
    """å•†å“æœªæ‰¾åˆ°å¼‚å¸¸"""
    
    def __init__(self, product_id, category=None):
        message = f"å•†å“ {product_id} æœªæ‰¾åˆ°"
        details = {'product_id': product_id}
        suggestions = [
            "æ£€æŸ¥å•†å“IDæ˜¯å¦æ­£ç¡®",
            "ç¡®è®¤å•†å“æ˜¯å¦å·²ä¸‹æ¶",
            "è”ç³»å®¢æœè·å–å¸®åŠ©"
        ]
        
        if category:
            details['category'] = category
            suggestions.insert(0, f"åœ¨ {category} åˆ†ç±»ä¸­æœç´¢ç±»ä¼¼å•†å“")
        
        super().__init__(
            message=message,
            error_code="PRODUCT_NOT_FOUND",
            details=details,
            suggestions=suggestions
        )
        
        self.product_id = product_id
        self.category = category

class InsufficientStockError(ECommerceError):
    """åº“å­˜ä¸è¶³å¼‚å¸¸"""
    
    def __init__(self, product_id, requested_quantity, available_quantity):
        message = f"å•†å“ {product_id} åº“å­˜ä¸è¶³ï¼šéœ€è¦ {requested_quantity}ï¼Œå¯ç”¨ {available_quantity}"
        
        super().__init__(
            message=message,
            error_code="INSUFFICIENT_STOCK",
            details={
                'product_id': product_id,
                'requested_quantity': requested_quantity,
                'available_quantity': available_quantity,
                'shortage': requested_quantity - available_quantity
            },
            suggestions=[
                f"å‡å°‘è´­ä¹°æ•°é‡è‡³ {available_quantity} æˆ–ä»¥ä¸‹",
                "ç­‰å¾…å•†å“è¡¥è´§",
                "é€‰æ‹©å…¶ä»–æ›¿ä»£å•†å“",
                "è”ç³»å®¢æœäº†è§£è¡¥è´§æ—¶é—´"
            ]
        )
```

#### 3. æ”¯æŒå¼‚å¸¸é“¾å’Œä¸Šä¸‹æ–‡

```python
class ServiceError(Exception):
    """æœåŠ¡å¼‚å¸¸ï¼Œæ”¯æŒå¼‚å¸¸é“¾"""
    
    def __init__(self, message, service_name=None, original_exception=None):
        super().__init__(message)
        self.service_name = service_name
        self.original_exception = original_exception
    
    def __str__(self):
        base_msg = f"Service Error"
        if self.service_name:
            base_msg += f" in {self.service_name}"
        base_msg += f": {super().__str__()}"
        
        if self.original_exception:
            base_msg += f" (caused by: {self.original_exception})"
        
        return base_msg

# ä½¿ç”¨ raise ... from ... è¯­æ³•ä¿æŒå¼‚å¸¸é“¾
def payment_service():
    """æ”¯ä»˜æœåŠ¡ç¤ºä¾‹"""
    try:
        # æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å¤±è´¥
        import requests
        response = requests.get("http://invalid-payment-api.com")
        response.raise_for_status()
        
    except requests.exceptions.RequestException as e:
        # ä¿æŒåŸå§‹å¼‚å¸¸ä¿¡æ¯çš„åŒæ—¶ï¼ŒæŠ›å‡ºä¸šåŠ¡ç›¸å…³çš„å¼‚å¸¸
        raise ServiceError(
            "æ”¯ä»˜æœåŠ¡è°ƒç”¨å¤±è´¥",
            service_name="PaymentAPI",
            original_exception=e
        ) from e

def order_processing():
    """è®¢å•å¤„ç†ç¤ºä¾‹"""
    try:
        payment_service()
    except ServiceError as e:
        print(f"è®¢å•å¤„ç†å¤±è´¥: {e}")
        print(f"åŸå§‹å¼‚å¸¸: {e.__cause__}")
```

### ğŸª å®æˆ˜æ¡ˆä¾‹ï¼šå­¦ç”Ÿç®¡ç†ç³»ç»Ÿå¼‚å¸¸è®¾è®¡

è®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„å­¦ç”Ÿç®¡ç†ç³»ç»Ÿå¼‚å¸¸ä½“ç³»ï¼š

```python
import re
from typing import List, Optional

# 1. å¼‚å¸¸åŸºç±»è®¾è®¡
class StudentManagementError(Exception):
    """å­¦ç”Ÿç®¡ç†ç³»ç»Ÿå¼‚å¸¸åŸºç±»"""
    
    def __init__(self, message: str, error_code: str = None, 
                 student_id: str = None, details: dict = None):
        super().__init__(message)
        self.error_code = error_code or "SMS_ERROR"
        self.student_id = student_id
        self.details = details or {}
        self.timestamp = time.time()

# 2. å…·ä½“å¼‚å¸¸ç±»è®¾è®¡
class StudentNotFoundError(StudentManagementError):
    """å­¦ç”Ÿæœªæ‰¾åˆ°å¼‚å¸¸"""
    
    def __init__(self, student_id: str, search_criteria: dict = None):
        message = f"å­¦ç”Ÿ {student_id} ä¸å­˜åœ¨"
        super().__init__(
            message=message,
            error_code="STUDENT_NOT_FOUND",
            student_id=student_id,
            details=search_criteria or {}
        )

class DuplicateStudentError(StudentManagementError):
    """é‡å¤å­¦ç”Ÿå¼‚å¸¸"""
    
    def __init__(self, student_id: str, existing_student_info: dict = None):
        message = f"å­¦ç”Ÿ {student_id} å·²å­˜åœ¨"
        super().__init__(
            message=message,
            error_code="DUPLICATE_STUDENT",
            student_id=student_id,
            details=existing_student_info or {}
        )

class InvalidStudentDataError(StudentManagementError):
    """å­¦ç”Ÿæ•°æ®æ— æ•ˆå¼‚å¸¸"""
    
    def __init__(self, field_name: str, field_value, validation_rule: str,
                 student_id: str = None):
        message = f"å­¦ç”Ÿæ•°æ®æ— æ•ˆï¼š{field_name} = '{field_value}' ä¸ç¬¦åˆè§„åˆ™ '{validation_rule}'"
        super().__init__(
            message=message,
            error_code="INVALID_STUDENT_DATA",
            student_id=student_id,
            details={
                'field_name': field_name,
                'field_value': field_value,
                'validation_rule': validation_rule
            }
        )
        self.field_name = field_name
        self.field_value = field_value

class GradeOperationError(StudentManagementError):
    """æˆç»©æ“ä½œå¼‚å¸¸"""
    
    def __init__(self, operation: str, student_id: str, subject: str = None,
                 reason: str = None):
        message = f"æˆç»©{operation}å¤±è´¥ï¼šå­¦ç”Ÿ {student_id}"
        if subject:
            message += f"ï¼Œç§‘ç›® {subject}"
        if reason:
            message += f"ï¼ŒåŸå› ï¼š{reason}"
        
        super().__init__(
            message=message,
            error_code="GRADE_OPERATION_ERROR",
            student_id=student_id,
            details={
                'operation': operation,
                'subject': subject,
                'reason': reason
            }
        )

# 3. å­¦ç”Ÿæ•°æ®éªŒè¯å™¨
class StudentValidator:
    """å­¦ç”Ÿæ•°æ®éªŒè¯å™¨"""
    
    @staticmethod
    def validate_student_id(student_id: str) -> None:
        """éªŒè¯å­¦ç”ŸIDæ ¼å¼"""
        if not student_id:
            raise InvalidStudentDataError(
                "student_id", student_id, "å­¦ç”ŸIDä¸èƒ½ä¸ºç©º"
            )
        
        # å­¦ç”ŸIDæ ¼å¼ï¼šå¹´ä»½(4ä½) + ä¸“ä¸šä»£ç (2ä½) + åºå·(4ä½)
        pattern = r'^\d{4}\d{2}\d{4}$'
        if not re.match(pattern, student_id):
            raise InvalidStudentDataError(
                "student_id", student_id, 
                "å­¦ç”ŸIDæ ¼å¼å¿…é¡»ä¸ºï¼šå¹´ä»½(4ä½)+ä¸“ä¸šä»£ç (2ä½)+åºå·(4ä½)"
            )
    
    @staticmethod
    def validate_name(name: str) -> None:
        """éªŒè¯å­¦ç”Ÿå§“å"""
        if not name or not name.strip():
            raise InvalidStudentDataError("name", name, "å§“åä¸èƒ½ä¸ºç©º")
        
        if len(name.strip()) < 2:
            raise InvalidStudentDataError("name", name, "å§“åé•¿åº¦è‡³å°‘2ä¸ªå­—ç¬¦")
        
        if len(name.strip()) > 20:
            raise InvalidStudentDataError("name", name, "å§“åé•¿åº¦ä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦")
    
    @staticmethod
    def validate_age(age: int) -> None:
        """éªŒè¯å­¦ç”Ÿå¹´é¾„"""
        if not isinstance(age, int):
            raise InvalidStudentDataError("age", age, "å¹´é¾„å¿…é¡»æ˜¯æ•´æ•°")
        
        if age < 16 or age > 100:
            raise InvalidStudentDataError("age", age, "å¹´é¾„å¿…é¡»åœ¨16-100ä¹‹é—´")
    
    @staticmethod
    def validate_email(email: str) -> None:
        """éªŒè¯é‚®ç®±æ ¼å¼"""
        if email:  # é‚®ç®±æ˜¯å¯é€‰çš„
            pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
            if not re.match(pattern, email):
                raise InvalidStudentDataError("email", email, "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    
    @staticmethod
    def validate_grade(score: float, subject: str) -> None:
        """éªŒè¯æˆç»©"""
        if not isinstance(score, (int, float)):
            raise InvalidStudentDataError("score", score, "æˆç»©å¿…é¡»æ˜¯æ•°å­—")
        
        if score < 0 or score > 100:
            raise InvalidStudentDataError("score", score, "æˆç»©å¿…é¡»åœ¨0-100ä¹‹é—´")

# 4. å­¦ç”Ÿç®¡ç†ç³»ç»Ÿä¸»ç±»
class StudentManagementSystem:
    """å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ"""
    
    def __init__(self):
        self.students = {}  # å­˜å‚¨å­¦ç”Ÿä¿¡æ¯
        self.grades = {}    # å­˜å‚¨æˆç»©ä¿¡æ¯
    
    def add_student(self, student_id: str, name: str, age: int, 
                   email: str = None) -> None:
        """æ·»åŠ å­¦ç”Ÿ"""
        try:
            # æ•°æ®éªŒè¯
            StudentValidator.validate_student_id(student_id)
            StudentValidator.validate_name(name)
            StudentValidator.validate_age(age)
            StudentValidator.validate_email(email)
            
            # æ£€æŸ¥é‡å¤
            if student_id in self.students:
                raise DuplicateStudentError(
                    student_id, 
                    self.students[student_id]
                )
            
            # æ·»åŠ å­¦ç”Ÿ
            self.students[student_id] = {
                'id': student_id,
                'name': name.strip(),
                'age': age,
                'email': email,
                'created_at': time.time()
            }
            
            # åˆå§‹åŒ–æˆç»©è®°å½•
            self.grades[student_id] = {}
            
            print(f"å­¦ç”Ÿ {name}({student_id}) æ·»åŠ æˆåŠŸ")
            
        except StudentManagementError:
            # é‡æ–°æŠ›å‡ºç³»ç»Ÿå¼‚å¸¸
            raise
        except Exception as e:
            # åŒ…è£…æœªçŸ¥å¼‚å¸¸
            raise StudentManagementError(
                f"æ·»åŠ å­¦ç”Ÿå¤±è´¥ï¼š{str(e)}",
                error_code="ADD_STUDENT_ERROR",
                student_id=student_id
            ) from e
    
    def get_student(self, student_id: str) -> dict:
        """è·å–å­¦ç”Ÿä¿¡æ¯"""
        try:
            StudentValidator.validate_student_id(student_id)
            
            if student_id not in self.students:
                raise StudentNotFoundError(student_id)
            
            return self.students[student_id].copy()
            
        except StudentManagementError:
            raise
        except Exception as e:
            raise StudentManagementError(
                f"è·å–å­¦ç”Ÿä¿¡æ¯å¤±è´¥ï¼š{str(e)}",
                error_code="GET_STUDENT_ERROR",
                student_id=student_id
            ) from e
    
    def add_grade(self, student_id: str, subject: str, score: float) -> None:
        """æ·»åŠ æˆç»©"""
        try:
            # éªŒè¯æ•°æ®
            StudentValidator.validate_student_id(student_id)
            StudentValidator.validate_grade(score, subject)
            
            # æ£€æŸ¥å­¦ç”Ÿæ˜¯å¦å­˜åœ¨
            if student_id not in self.students:
                raise StudentNotFoundError(student_id)
            
            # æ·»åŠ æˆç»©
            if student_id not in self.grades:
                self.grades[student_id] = {}
            
            self.grades[student_id][subject] = {
                'score': score,
                'added_at': time.time()
            }
            
            student_name = self.students[student_id]['name']
            print(f"ä¸ºå­¦ç”Ÿ {student_name}({student_id}) æ·»åŠ  {subject} æˆç»©ï¼š{score}")
            
        except StudentManagementError:
            raise
        except Exception as e:
            raise GradeOperationError(
                "æ·»åŠ ", student_id, subject, str(e)
            ) from e
    
    def get_student_grades(self, student_id: str) -> dict:
        """è·å–å­¦ç”Ÿæ‰€æœ‰æˆç»©"""
        try:
            # æ£€æŸ¥å­¦ç”Ÿæ˜¯å¦å­˜åœ¨
            if student_id not in self.students:
                raise StudentNotFoundError(student_id)
            
            return self.grades.get(student_id, {}).copy()
            
        except StudentManagementError:
            raise
        except Exception as e:
            raise GradeOperationError(
                "æŸ¥è¯¢", student_id, None, str(e)
            ) from e

# 5. å¼‚å¸¸å¤„ç†æ¼”ç¤º
def demonstrate_exception_handling():
    """æ¼”ç¤ºå¼‚å¸¸å¤„ç†"""
    
    sms = StudentManagementSystem()
    
    print("=== å­¦ç”Ÿç®¡ç†ç³»ç»Ÿå¼‚å¸¸å¤„ç†æ¼”ç¤º ===\n")
    
    # æ­£å¸¸æ“ä½œ
    try:
        sms.add_student("20240101001", "å¼ ä¸‰", 20, "zhangsan@example.com")
        sms.add_grade("20240101001", "æ•°å­¦", 95.5)
    except StudentManagementError as e:
        print(f"æ“ä½œå¤±è´¥: {e}")
    
    # å¼‚å¸¸æƒ…å†µæ¼”ç¤º
    test_cases = [
        # æµ‹è¯•æ— æ•ˆå­¦ç”ŸID
        lambda: sms.add_student("invalid_id", "æå››", 19),
        
        # æµ‹è¯•é‡å¤å­¦ç”Ÿ
        lambda: sms.add_student("20240101001", "ç‹äº”", 21),
        
        # æµ‹è¯•å­¦ç”Ÿæœªæ‰¾åˆ°
        lambda: sms.get_student("20240101999"),
        
        # æµ‹è¯•æ— æ•ˆå¹´é¾„
        lambda: sms.add_student("20240101002", "èµµå…­", 150),
        
        # æµ‹è¯•æ— æ•ˆæˆç»©
        lambda: sms.add_grade("20240101001", "è‹±è¯­", 150),
        
        # æµ‹è¯•æ— æ•ˆé‚®ç®±
        lambda: sms.add_student("20240101003", "é’±ä¸ƒ", 20, "invalid_email"),
    ]
    
    for i, test_case in enumerate(test_cases, 1):
        print(f"\n--- æµ‹è¯•ç”¨ä¾‹ {i} ---")
        try:
            test_case()
        except StudentManagementError as e:
            print(f"æ•è·å¼‚å¸¸: {e}")
            print(f"é”™è¯¯ä»£ç : {e.error_code}")
            if e.details:
                print(f"è¯¦ç»†ä¿¡æ¯: {e.details}")

# æµ‹è¯•è‡ªå®šä¹‰å¼‚å¸¸
if __name__ == "__main__":
    demonstrate_exception_handling()
```

### ğŸ¯ ç»ƒä¹ é¢˜ï¼šè‡ªå®šä¹‰å¼‚å¸¸è®¾è®¡

```python
# ç»ƒä¹ 1ï¼šè®¾è®¡å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿå¼‚å¸¸
class LibrarySystemError(Exception):
    """
    ç»ƒä¹ 1ï¼šä¸ºå›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿè®¾è®¡å¼‚å¸¸ä½“ç³»
    
    è¦æ±‚ï¼š
    1. è®¾è®¡åŸºç¡€å¼‚å¸¸ç±» LibrarySystemError
    2. è®¾è®¡å…·ä½“å¼‚å¸¸ï¼šBookNotFoundError, BookUnavailableError, 
       UserNotFoundError, BorrowLimitExceededError
    3. æ¯ä¸ªå¼‚å¸¸åº”è¯¥åŒ…å«ç›¸å…³çš„ä¸šåŠ¡ä¿¡æ¯
    4. å®ç°å‹å¥½çš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤º
    """
    pass

# åœ¨è¿™é‡Œå®Œæˆä½ çš„å¼‚å¸¸è®¾è®¡...

# ç»ƒä¹ 2ï¼šè®¾è®¡åœ¨çº¿è´­ç‰©è½¦å¼‚å¸¸
class ShoppingCartError(Exception):
    """
    ç»ƒä¹ 2ï¼šä¸ºåœ¨çº¿è´­ç‰©è½¦è®¾è®¡å¼‚å¸¸ä½“ç³»
    
    è¦æ±‚ï¼š
    1. è®¾è®¡è´­ç‰©è½¦ç›¸å…³å¼‚å¸¸
    2. å¤„ç†å•†å“åº“å­˜ã€ä»·æ ¼å˜åŠ¨ã€ä¼˜æƒ åˆ¸ç­‰åœºæ™¯
    3. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå»ºè®®è§£å†³æ–¹æ¡ˆ
    4. æ”¯æŒé”™è¯¯ä»£ç ç”¨äºAPIè¿”å›
    """
    pass

# åœ¨è¿™é‡Œå®Œæˆä½ çš„å¼‚å¸¸è®¾è®¡...
```

### ğŸ” æœ¬èŠ‚å°ç»“

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ï¼š

1. **è‡ªå®šä¹‰å¼‚å¸¸çš„å¿…è¦æ€§**ï¼šè¡¨è¾¾ä¸šåŠ¡è¯­ä¹‰ã€åŒºåˆ†é”™è¯¯ç±»å‹ã€æºå¸¦è¯¦ç»†ä¿¡æ¯
2. **è®¾è®¡åŸåˆ™**ï¼šé€‰æ‹©åˆé€‚åŸºç±»ã€å»ºç«‹å±‚æ¬¡ç»“æ„ã€æä¾›ä¸°å¯Œä¿¡æ¯
3. **é«˜çº§ç‰¹æ€§**ï¼šå¼‚å¸¸é“¾ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ã€æ•°æ®éªŒè¯é›†æˆ
4. **å®æˆ˜åº”ç”¨**ï¼šå­¦ç”Ÿç®¡ç†ç³»ç»Ÿçš„å®Œæ•´å¼‚å¸¸è®¾è®¡

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- è‡ªå®šä¹‰å¼‚å¸¸è®©é”™è¯¯å¤„ç†æ›´ç²¾ç¡®å’Œå‹å¥½
- è‰¯å¥½çš„å¼‚å¸¸è®¾è®¡æ˜¯ç³»ç»Ÿå¥å£®æ€§çš„é‡è¦ä¿è¯
- å¼‚å¸¸åº”è¯¥æºå¸¦è¶³å¤Ÿçš„ä¿¡æ¯å¸®åŠ©å®šä½å’Œè§£å†³é—®é¢˜
- å¼‚å¸¸å±‚æ¬¡ç»“æ„ä¾¿äºåˆ†ç±»å¤„ç†å’Œç»´æŠ¤

ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å­¦ä¹ è°ƒè¯•æŠ€æœ¯ï¼ŒæŒæ¡å¿«é€Ÿå®šä½å’Œè§£å†³ç¨‹åºé—®é¢˜çš„æ–¹æ³•ã€‚

## 6.3 è°ƒè¯•æŠ€æœ¯ä¸å·¥å…·ï¼šæˆä¸ºç¨‹åº"ä¾¦æ¢"

### ğŸ•µï¸â€â™€ï¸ è°ƒè¯•çš„è‰ºæœ¯ï¼šåƒä¾¦æ¢ä¸€æ ·æ€è€ƒ

è°ƒè¯•å°±åƒç ´æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦ï¼š
- **è§‚å¯Ÿç°è±¡**ï¼šç¨‹åºå‡ºç°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
- **æ”¶é›†è¯æ®**ï¼šé”™è¯¯ä¿¡æ¯ã€æ—¥å¿—ã€å˜é‡çŠ¶æ€
- **åˆ†æçº¿ç´¢**ï¼šå¼‚å¸¸å‘ç”Ÿçš„ä½ç½®å’ŒåŸå› 
- **éªŒè¯å‡è®¾**ï¼šé€šè¿‡æµ‹è¯•éªŒè¯æ¨ç†
- **è§£å†³é—®é¢˜**ï¼šä¿®å¤bugå¹¶ç¡®ä¿ä¸ä¼šå†å‡ºç°

### ğŸ” è°ƒè¯•æ–¹æ³•è®ºï¼šä»ç®€å•åˆ°é«˜çº§

#### 1. Printè°ƒè¯•æ³•ï¼šæœ€ç®€å•ä¹Ÿæœ€å®ç”¨

```python
# ç¤ºä¾‹ï¼šæŸ¥æ‰¾åˆ—è¡¨å¤„ç†ä¸­çš„bug
def process_student_scores(scores):
    """å¤„ç†å­¦ç”Ÿæˆç»©ï¼Œè®¡ç®—å¹³å‡åˆ†å’Œç­‰çº§"""
    
    print(f"DEBUG: è¾“å…¥çš„æˆç»©åˆ—è¡¨: {scores}")  # è§‚å¯Ÿè¾“å…¥
    
    total = 0
    count = 0
    
    for score in scores:
        print(f"DEBUG: å¤„ç†æˆç»©: {score}")  # è§‚å¯Ÿæ¯æ¬¡è¿­ä»£
        
        if score >= 0:  # å¿½ç•¥æ— æ•ˆæˆç»©
            total += score
            count += 1
            print(f"DEBUG: å½“å‰æ€»åˆ†: {total}, æ•°é‡: {count}")
    
    if count == 0:
        print("DEBUG: æ²¡æœ‰æœ‰æ•ˆæˆç»©")
        return None
    
    average = total / count
    print(f"DEBUG: è®¡ç®—å¾—åˆ°å¹³å‡åˆ†: {average}")
    
    # è®¡ç®—ç­‰çº§
    if average >= 90:
        grade = 'A'
    elif average >= 80:
        grade = 'B'
    elif average >= 70:
        grade = 'C'
    elif average >= 60:
        grade = 'D'
    else:
        grade = 'F'
    
    print(f"DEBUG: æœ€ç»ˆç­‰çº§: {grade}")
    
    return {
        'average': average,
        'grade': grade,
        'total_students': count
    }

# æ”¹è¿›ç‰ˆï¼šä½¿ç”¨å¼€å…³æ§åˆ¶è°ƒè¯•è¾“å‡º
DEBUG_MODE = True

def debug_print(*args, **kwargs):
    """æ¡ä»¶è°ƒè¯•æ‰“å°"""
    if DEBUG_MODE:
        print("[DEBUG]", *args, **kwargs)

def process_student_scores_improved(scores):
    """æ”¹è¿›çš„å­¦ç”Ÿæˆç»©å¤„ç†"""
    
    debug_print(f"è¾“å…¥çš„æˆç»©åˆ—è¡¨: {scores}")
    
    valid_scores = [score for score in scores if score >= 0]
    debug_print(f"æœ‰æ•ˆæˆç»©: {valid_scores}")
    
    if not valid_scores:
        debug_print("æ²¡æœ‰æœ‰æ•ˆæˆç»©")
        return None
    
    average = sum(valid_scores) / len(valid_scores)
    debug_print(f"å¹³å‡åˆ†: {average}")
    
    # ä½¿ç”¨å­—å…¸ç®€åŒ–ç­‰çº§è®¡ç®—
    grade_thresholds = [(90, 'A'), (80, 'B'), (70, 'C'), (60, 'D')]
    grade = 'F'
    for threshold, letter in grade_thresholds:
        if average >= threshold:
            grade = letter
            break
    
    debug_print(f"ç­‰çº§: {grade}")
    
    return {
        'average': round(average, 2),
        'grade': grade,
        'total_students': len(valid_scores)
    }

# æµ‹è¯•ä¸¤ä¸ªç‰ˆæœ¬
if __name__ == "__main__":
    test_scores = [85, 92, 78, -1, 88, 95]
    print("=== åŸºç¡€ç‰ˆæœ¬ ===")
    result1 = process_student_scores(test_scores)
    print(f"ç»“æœ: {result1}")
    
    print("\n=== æ”¹è¿›ç‰ˆæœ¬ ===")
    result2 = process_student_scores_improved(test_scores)
    print(f"ç»“æœ: {result2}")
```

#### 2. æ–­è¨€è°ƒè¯•æ³•ï¼šéªŒè¯å‡è®¾

```python
def safe_divide(a, b):
    """å®‰å…¨é™¤æ³•ï¼Œä½¿ç”¨æ–­è¨€éªŒè¯å‡è®¾"""
    
    # æ–­è¨€ï¼šè¾“å…¥åº”è¯¥æ˜¯æ•°å­—
    assert isinstance(a, (int, float)), f"aå¿…é¡»æ˜¯æ•°å­—ï¼Œå®é™…ç±»å‹: {type(a)}"
    assert isinstance(b, (int, float)), f"bå¿…é¡»æ˜¯æ•°å­—ï¼Œå®é™…ç±»å‹: {type(b)}"
    
    # æ–­è¨€ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶
    assert b != 0, "é™¤æ•°ä¸èƒ½ä¸ºé›¶"
    
    result = a / b
    
    # æ–­è¨€ï¼šç»“æœåº”è¯¥æ˜¯æœ‰é™æ•°
    assert not (math.isinf(result) or math.isnan(result)), "è®¡ç®—ç»“æœæ— æ•ˆ"
    
    return result

# æ•°æ®éªŒè¯ä¸­çš„æ–­è¨€ä½¿ç”¨
def validate_student_info(name, age, email):
    """éªŒè¯å­¦ç”Ÿä¿¡æ¯"""
    
    # ä½¿ç”¨æ–­è¨€è¿›è¡Œå¿«é€ŸéªŒè¯ï¼ˆå¼€å‘é˜¶æ®µï¼‰
    assert isinstance(name, str), "å§“åå¿…é¡»æ˜¯å­—ç¬¦ä¸²"
    assert len(name.strip()) > 0, "å§“åä¸èƒ½ä¸ºç©º"
    assert isinstance(age, int), "å¹´é¾„å¿…é¡»æ˜¯æ•´æ•°"
    assert 16 <= age <= 100, f"å¹´é¾„å¿…é¡»åœ¨16-100ä¹‹é—´ï¼Œå®é™…å€¼: {age}"
    
    if email:  # é‚®ç®±æ˜¯å¯é€‰çš„
        assert isinstance(email, str), "é‚®ç®±å¿…é¡»æ˜¯å­—ç¬¦ä¸²"
        assert "@" in email, "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
    
    print("å­¦ç”Ÿä¿¡æ¯éªŒè¯é€šè¿‡")
    return True

# ç¤ºä¾‹ï¼šä½¿ç”¨æ–­è¨€è¿›è¡Œè°ƒè¯•
def calculate_bmi(weight, height):
    """è®¡ç®—BMIæŒ‡æ•°"""
    
    print(f"è®¡ç®—BMI: weight={weight}, height={height}")
    
    # å¼€å‘é˜¶æ®µçš„æ–­è¨€
    assert weight > 0, f"ä½“é‡å¿…é¡»å¤§äº0ï¼Œå®é™…å€¼: {weight}"
    assert height > 0, f"èº«é«˜å¿…é¡»å¤§äº0ï¼Œå®é™…å€¼: {height}"
    assert height < 3.0, f"èº«é«˜ä¼¼ä¹ä¸åˆç†(å•ä½æ˜¯ç±³)ï¼Œå®é™…å€¼: {height}"
    
    bmi = weight / (height ** 2)
    
    # éªŒè¯ç»“æœåˆç†æ€§
    assert 10 <= bmi <= 100, f"BMIå€¼ä¼¼ä¹ä¸åˆç†: {bmi}"
    
    return round(bmi, 2)

# æµ‹è¯•æ–­è¨€è°ƒè¯•
if __name__ == "__main__":
    try:
        print("=== æ–­è¨€è°ƒè¯•æµ‹è¯• ===")
        result1 = safe_divide(10, 2)
        print(f"10 / 2 = {result1}")
        
        result2 = calculate_bmi(70, 1.75)
        print(f"BMI = {result2}")
        
        # è¿™ä¼šè§¦å‘æ–­è¨€é”™è¯¯
        # result3 = calculate_bmi(-5, 1.75)
        
    except AssertionError as e:
        print(f"æ–­è¨€é”™è¯¯: {e}")
```

#### 3. äº¤äº’å¼è°ƒè¯•ï¼šæ·±å…¥ç¨‹åºå†…éƒ¨

```python
import pdb

def complex_calculation(numbers):
    """å¤æ‚è®¡ç®—ç¤ºä¾‹ï¼Œæ¼”ç¤ºpdbè°ƒè¯•"""
    
    result = []
    total = 0
    
    for i, num in enumerate(numbers):
        # è®¾ç½®æ–­ç‚¹ - ç¨‹åºä¼šåœ¨è¿™é‡Œæš‚åœ
        pdb.set_trace()
        
        # è¿›è¡Œä¸€äº›å¤æ‚è®¡ç®—
        if num % 2 == 0:
            processed = num * 2
        else:
            processed = num * 3 + 1
        
        result.append(processed)
        total += processed
        
        print(f"ç¬¬{i+1}ä¸ªæ•°å­— {num} å¤„ç†åä¸º {processed}")
    
    average = total / len(numbers) if numbers else 0
    
    return {
        'processed_numbers': result,
        'total': total,
        'average': average
    }

# pdbè°ƒè¯•å‘½ä»¤ä»‹ç»
"""
å¸¸ç”¨pdbå‘½ä»¤ï¼š
- n (next): æ‰§è¡Œä¸‹ä¸€è¡Œ
- s (step): è¿›å…¥å‡½æ•°å†…éƒ¨
- c (continue): ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹
- l (list): æ˜¾ç¤ºå½“å‰ä»£ç 
- p <variable>: æ‰“å°å˜é‡å€¼
- pp <variable>: ç¾åŒ–æ‰“å°å˜é‡å€¼
- w (where): æ˜¾ç¤ºè°ƒç”¨æ ˆ
- u (up): ä¸Šç§»ä¸€çº§è°ƒç”¨æ ˆ
- d (down): ä¸‹ç§»ä¸€çº§è°ƒç”¨æ ˆ
- b <line>: åœ¨æŒ‡å®šè¡Œè®¾ç½®æ–­ç‚¹
- cl (clear): æ¸…é™¤æ–­ç‚¹
- q (quit): é€€å‡ºè°ƒè¯•å™¨
"""

# æ¡ä»¶æ–­ç‚¹ç¤ºä¾‹
def find_problematic_data(data_list):
    """æŸ¥æ‰¾æœ‰é—®é¢˜çš„æ•°æ®"""
    
    for i, item in enumerate(data_list):
        # åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ–­ç‚¹
        if item < 0:
            pdb.set_trace()  # åªæœ‰å½“itemä¸ºè´Ÿæ•°æ—¶æ‰æ–­ç‚¹
        
        # å¤„ç†æ•°æ®
        processed = item ** 2
        print(f"å¤„ç†ç¬¬{i}é¡¹: {item} -> {processed}")

# ä½¿ç”¨æ–­ç‚¹è£…é¥°å™¨
def breakpoint_decorator(func):
    """æ–­ç‚¹è£…é¥°å™¨ï¼Œåœ¨å‡½æ•°å…¥å£è®¾ç½®æ–­ç‚¹"""
    def wrapper(*args, **kwargs):
        print(f"è¿›å…¥å‡½æ•° {func.__name__}")
        pdb.set_trace()
        return func(*args, **kwargs)
    return wrapper

@breakpoint_decorator
def critical_function(x, y):
    """é‡è¦å‡½æ•°ï¼Œéœ€è¦ä»”ç»†è°ƒè¯•"""
    result = x * y + (x - y) ** 2
    return result
```

### ğŸ› ï¸ é«˜çº§è°ƒè¯•å·¥å…·

#### 1. loggingæ¨¡å—ï¼šç”Ÿäº§çº§è°ƒè¯•

```python
import logging
import time
from datetime import datetime

# é…ç½®æ—¥å¿—ç³»ç»Ÿ
def setup_logging():
    """é…ç½®æ—¥å¿—ç³»ç»Ÿ"""
    
    # åˆ›å»ºlogger
    logger = logging.getLogger('StudentSystem')
    logger.setLevel(logging.DEBUG)
    
    # åˆ›å»ºæ–‡ä»¶å¤„ç†å™¨
    file_handler = logging.FileHandler('student_system.log', encoding='utf-8')
    file_handler.setLevel(logging.INFO)
    
    # åˆ›å»ºæ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.DEBUG)
    
    # åˆ›å»ºæ ¼å¼åŒ–å™¨
    file_formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(funcName)s:%(lineno)d - %(message)s'
    )
    console_formatter = logging.Formatter(
        '%(levelname)s - %(funcName)s - %(message)s'
    )
    
    # åº”ç”¨æ ¼å¼åŒ–å™¨
    file_handler.setFormatter(file_formatter)
    console_handler.setFormatter(console_formatter)
    
    # æ·»åŠ å¤„ç†å™¨
    logger.addHandler(file_handler)
    logger.addHandler(console_handler)
    
    return logger

# åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ä½¿ç”¨æ—¥å¿—
class StudentManager:
    """å­¦ç”Ÿç®¡ç†å™¨ï¼Œæ¼”ç¤ºæ—¥å¿—è°ƒè¯•"""
    
    def __init__(self):
        self.logger = setup_logging()
        self.students = {}
        self.logger.info("å­¦ç”Ÿç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ")
    
    def add_student(self, student_id, name, age):
        """æ·»åŠ å­¦ç”Ÿ"""
        self.logger.debug(f"å¼€å§‹æ·»åŠ å­¦ç”Ÿ: {student_id}, {name}, {age}")
        
        try:
            # éªŒè¯æ•°æ®
            if not student_id:
                self.logger.error("å­¦ç”ŸIDä¸ºç©º")
                raise ValueError("å­¦ç”ŸIDä¸èƒ½ä¸ºç©º")
            
            if student_id in self.students:
                self.logger.warning(f"å­¦ç”Ÿ {student_id} å·²å­˜åœ¨ï¼Œè·³è¿‡æ·»åŠ ")
                return False
            
            # æ·»åŠ å­¦ç”Ÿ
            self.students[student_id] = {
                'name': name,
                'age': age,
                'created_at': time.time()
            }
            
            self.logger.info(f"æˆåŠŸæ·»åŠ å­¦ç”Ÿ: {name}({student_id})")
            return True
            
        except Exception as e:
            self.logger.error(f"æ·»åŠ å­¦ç”Ÿå¤±è´¥: {e}", exc_info=True)
            raise
    
    def get_student(self, student_id):
        """è·å–å­¦ç”Ÿä¿¡æ¯"""
        self.logger.debug(f"æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯: {student_id}")
        
        if student_id not in self.students:
            self.logger.warning(f"å­¦ç”Ÿ {student_id} ä¸å­˜åœ¨")
            return None
        
        student = self.students[student_id]
        self.logger.debug(f"æ‰¾åˆ°å­¦ç”Ÿ: {student}")
        return student
    
    def get_statistics(self):
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        self.logger.debug("ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯")
        
        total_students = len(self.students)
        
        if total_students == 0:
            self.logger.info("æš‚æ— å­¦ç”Ÿæ•°æ®")
            return {'total': 0}
        
        ages = [s['age'] for s in self.students.values()]
        avg_age = sum(ages) / len(ages)
        
        stats = {
            'total': total_students,
            'average_age': round(avg_age, 2),
            'min_age': min(ages),
            'max_age': max(ages)
        }
        
        self.logger.info(f"ç»Ÿè®¡ä¿¡æ¯: {stats}")
        return stats

# æ€§èƒ½è°ƒè¯•è£…é¥°å™¨
def performance_logger(func):
    """æ€§èƒ½æ—¥å¿—è£…é¥°å™¨"""
    def wrapper(*args, **kwargs):
        logger = logging.getLogger('Performance')
        
        start_time = time.time()
        logger.debug(f"å¼€å§‹æ‰§è¡Œ {func.__name__}")
        
        try:
            result = func(*args, **kwargs)
            end_time = time.time()
            execution_time = end_time - start_time
            
            logger.info(f"{func.__name__} æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶ {execution_time:.4f}ç§’")
            return result
            
        except Exception as e:
            end_time = time.time()
            execution_time = end_time - start_time
            
            logger.error(f"{func.__name__} æ‰§è¡Œå¤±è´¥ï¼Œè€—æ—¶ {execution_time:.4f}ç§’ï¼Œé”™è¯¯: {e}")
            raise
    
    return wrapper

@performance_logger
def slow_function():
    """æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ"""
    time.sleep(1)
    return "å®Œæˆ"

# æµ‹è¯•æ—¥å¿—ç³»ç»Ÿ
if __name__ == "__main__":
    print("=== æ—¥å¿—è°ƒè¯•æ¼”ç¤º ===")
    
    # è®¾ç½®æ—¥å¿—çº§åˆ«
    logging.basicConfig(level=logging.DEBUG)
    
    manager = StudentManager()
    
    # æ­£å¸¸æ“ä½œ
    manager.add_student("001", "å¼ ä¸‰", 20)
    manager.add_student("002", "æå››", 22)
    
    # å¼‚å¸¸æ“ä½œ
    try:
        manager.add_student("", "ç‹äº”", 21)  # ç©ºID
    except ValueError:
        pass
    
    # é‡å¤æ·»åŠ 
    manager.add_student("001", "å¼ ä¸‰", 20)
    
    # æŸ¥è¯¢
    student = manager.get_student("001")
    print(f"æŸ¥è¯¢ç»“æœ: {student}")
    
    # ç»Ÿè®¡
    stats = manager.get_statistics()
    print(f"ç»Ÿè®¡ä¿¡æ¯: {stats}")
    
    # æ€§èƒ½æµ‹è¯•
    slow_function()
```

#### 2. å¼‚å¸¸è¿½è¸ªï¼šè·å–å®Œæ•´çš„è°ƒç”¨æ ˆ

```python
import traceback
import sys

def detailed_exception_handler():
    """è¯¦ç»†çš„å¼‚å¸¸å¤„ç†å’Œè¿½è¸ª"""
    
    def risky_function(x, y):
        """å¯èƒ½å‡ºé”™çš„å‡½æ•°"""
        if y == 0:
            raise ZeroDivisionError("ä¸èƒ½é™¤ä»¥é›¶")
        return x / y
    
    def middle_function(a, b):
        """ä¸­é—´å‡½æ•°"""
        result = risky_function(a, b)
        return result * 2
    
    def top_function():
        """é¡¶å±‚å‡½æ•°"""
        return middle_function(10, 0)  # è¿™ä¼šå¯¼è‡´å¼‚å¸¸
    
    try:
        top_function()
    except Exception as e:
        print("=== å¼‚å¸¸ä¿¡æ¯ ===")
        print(f"å¼‚å¸¸ç±»å‹: {type(e).__name__}")
        print(f"å¼‚å¸¸æ¶ˆæ¯: {str(e)}")
        
        print("\n=== è°ƒç”¨æ ˆè¿½è¸ª ===")
        traceback.print_exc()
        
        print("\n=== è¯¦ç»†è¿½è¸ªä¿¡æ¯ ===")
        exc_type, exc_value, exc_traceback = sys.exc_info()
        
        # è·å–è¿½è¸ªä¿¡æ¯
        tb_lines = traceback.format_exception(exc_type, exc_value, exc_traceback)
        for line in tb_lines:
            print(line.rstrip())
        
        print("\n=== è°ƒç”¨æ ˆè¯¦æƒ… ===")
        # æ‰‹åŠ¨è§£æè°ƒç”¨æ ˆ
        tb = exc_traceback
        while tb is not None:
            frame = tb.tb_frame
            filename = frame.f_code.co_filename
            function_name = frame.f_code.co_name
            line_number = tb.tb_lineno
            
            print(f"æ–‡ä»¶: {filename}")
            print(f"å‡½æ•°: {function_name}")
            print(f"è¡Œå·: {line_number}")
            print(f"å±€éƒ¨å˜é‡: {frame.f_locals}")
            print("-" * 40)
            
            tb = tb.tb_next

# è‡ªå®šä¹‰å¼‚å¸¸è¿½è¸ªå™¨
class ExceptionTracker:
    """å¼‚å¸¸è¿½è¸ªå™¨"""
    
    def __init__(self, log_file="exceptions.log"):
        self.log_file = log_file
        self.exceptions = []
    
    def track_exception(self, func):
        """å¼‚å¸¸è¿½è¸ªè£…é¥°å™¨"""
        def wrapper(*args, **kwargs):
            try:
                return func(*args, **kwargs)
            except Exception as e:
                # è®°å½•å¼‚å¸¸ä¿¡æ¯
                exception_info = {
                    'function': func.__name__,
                    'args': args,
                    'kwargs': kwargs,
                    'exception_type': type(e).__name__,
                    'exception_message': str(e),
                    'timestamp': time.time(),
                    'traceback': traceback.format_exc()
                }
                
                self.exceptions.append(exception_info)
                self._log_exception(exception_info)
                
                # é‡æ–°æŠ›å‡ºå¼‚å¸¸
                raise
        
        return wrapper
    
    def _log_exception(self, exception_info):
        """è®°å½•å¼‚å¸¸åˆ°æ–‡ä»¶"""
        with open(self.log_file, 'a', encoding='utf-8') as f:
            f.write(f"\n{'='*50}\n")
            f.write(f"æ—¶é—´: {datetime.fromtimestamp(exception_info['timestamp'])}\n")
            f.write(f"å‡½æ•°: {exception_info['function']}\n")
            f.write(f"å‚æ•°: {exception_info['args']}\n")
            f.write(f"å…³é”®å­—å‚æ•°: {exception_info['kwargs']}\n")
            f.write(f"å¼‚å¸¸ç±»å‹: {exception_info['exception_type']}\n")
            f.write(f"å¼‚å¸¸æ¶ˆæ¯: {exception_info['exception_message']}\n")
            f.write(f"è°ƒç”¨æ ˆ:\n{exception_info['traceback']}\n")
    
    def get_exception_summary(self):
        """è·å–å¼‚å¸¸æ±‡æ€»"""
        if not self.exceptions:
            return "æ²¡æœ‰è®°å½•åˆ°å¼‚å¸¸"
        
        summary = f"æ€»è®¡å¼‚å¸¸æ•°é‡: {len(self.exceptions)}\n"
        
        # æŒ‰å¼‚å¸¸ç±»å‹åˆ†ç»„
        exception_types = {}
        for exc in self.exceptions:
            exc_type = exc['exception_type']
            exception_types[exc_type] = exception_types.get(exc_type, 0) + 1
        
        summary += "å¼‚å¸¸ç±»å‹åˆ†å¸ƒ:\n"
        for exc_type, count in exception_types.items():
            summary += f"  {exc_type}: {count}æ¬¡\n"
        
        return summary

# ä½¿ç”¨å¼‚å¸¸è¿½è¸ªå™¨
tracker = ExceptionTracker()

@tracker.track_exception
def problematic_function(x, y):
    """æœ‰é—®é¢˜çš„å‡½æ•°"""
    if x < 0:
        raise ValueError("xä¸èƒ½ä¸ºè´Ÿæ•°")
    if y == 0:
        raise ZeroDivisionError("yä¸èƒ½ä¸ºé›¶")
    return x / y

# æµ‹è¯•å¼‚å¸¸è¿½è¸ª
if __name__ == "__main__":
    print("=== å¼‚å¸¸è¿½è¸ªæ¼”ç¤º ===")
    
    # æ­£å¸¸æƒ…å†µ
    try:
        result = problematic_function(10, 2)
        print(f"æ­£å¸¸ç»“æœ: {result}")
    except Exception as e:
        print(f"æ•è·å¼‚å¸¸: {e}")
    
    # å¼‚å¸¸æƒ…å†µ
    test_cases = [
        (-5, 2),   # ValueError
        (10, 0),   # ZeroDivisionError
        (-3, 0),   # ValueError (å…ˆè§¦å‘)
    ]
    
    for x, y in test_cases:
        try:
            problematic_function(x, y)
        except Exception as e:
            print(f"æµ‹è¯• ({x}, {y}) å¤±è´¥: {e}")
    
    # æ˜¾ç¤ºå¼‚å¸¸æ±‡æ€»
    print("\n=== å¼‚å¸¸æ±‡æ€» ===")
    print(tracker.get_exception_summary())
    
    # æ¼”ç¤ºè¯¦ç»†å¼‚å¸¸å¤„ç†
    detailed_exception_handler()
```

### ğŸ¯ è°ƒè¯•ç­–ç•¥ä¸æœ€ä½³å®è·µ

```python
# è°ƒè¯•ç­–ç•¥æ€»ç»“
class DebuggingStrategy:
    """è°ƒè¯•ç­–ç•¥æŒ‡å—"""
    
    @staticmethod
    def binary_search_debugging():
        """äºŒåˆ†æŸ¥æ‰¾è°ƒè¯•æ³•"""
        print("""
        äºŒåˆ†æŸ¥æ‰¾è°ƒè¯•æ³•ï¼š
        1. åœ¨ç¨‹åºä¸­é—´ä½ç½®æ·»åŠ è°ƒè¯•è¾“å‡º
        2. ç¡®å®šé—®é¢˜åœ¨å‰åŠéƒ¨åˆ†è¿˜æ˜¯ååŠéƒ¨åˆ†
        3. åœ¨æœ‰é—®é¢˜çš„éƒ¨åˆ†ç»§ç»­äºŒåˆ†
        4. é‡å¤ç›´åˆ°æ‰¾åˆ°ç¡®åˆ‡çš„é—®é¢˜ä½ç½®
        
        é€‚ç”¨åœºæ™¯ï¼šé•¿å‡½æ•°æˆ–å¤æ‚é€»è¾‘ä¸­çš„bugå®šä½
        """)
    
    @staticmethod
    def rubber_duck_debugging():
        """æ©¡çš®é¸­è°ƒè¯•æ³•"""
        print("""
        æ©¡çš®é¸­è°ƒè¯•æ³•ï¼š
        1. å‘æ©¡çš®é¸­ï¼ˆæˆ–ä»»ä½•ç‰©ä½“ï¼‰è¯¦ç»†è§£é‡Šä½ çš„ä»£ç 
        2. é€è¡Œè¯´æ˜ä»£ç çš„é¢„æœŸè¡Œä¸º
        3. å½“ä½ å‘ç°è¯´å‡ºçš„å’Œå®é™…çš„ä¸ä¸€è‡´æ—¶ï¼Œbugå°±æš´éœ²äº†
        
        åŸç†ï¼šé€šè¿‡è¡¨è¾¾å¼ºè¿«å¤§è„‘é‡æ–°æ•´ç†æ€è·¯
        """)
    
    @staticmethod
    def minimum_reproducible_example():
        """æœ€å°å¯å¤ç°ç¤ºä¾‹"""
        print("""
        åˆ›å»ºæœ€å°å¯å¤ç°ç¤ºä¾‹ï¼š
        1. ä»å®Œæ•´ç¨‹åºä¸­æå–å‡ºæœ€å°çš„èƒ½é‡ç°é—®é¢˜çš„ä»£ç 
        2. ç§»é™¤æ‰€æœ‰ä¸ç›¸å…³çš„ä»£ç 
        3. ç®€åŒ–è¾“å…¥æ•°æ®
        4. åœ¨ç®€åŒ–çš„ç¯å¢ƒä¸­æ›´å®¹æ˜“å‘ç°é—®é¢˜
        
        ä¼˜åŠ¿ï¼šé™ä½å¤æ‚åº¦ï¼Œæé«˜å®šä½æ•ˆç‡
        """)

# è°ƒè¯•æ¸…å•
class DebuggingChecklist:
    """è°ƒè¯•æ£€æŸ¥æ¸…å•"""
    
    COMMON_BUGS = [
        "å˜é‡åæ‹¼å†™é”™è¯¯",
        "ç¼©è¿›é—®é¢˜",
        "å¾ªç¯è¾¹ç•Œæ¡ä»¶é”™è¯¯ï¼ˆoff-by-oneï¼‰",
        "ç©ºå€¼/Noneæœªå¤„ç†",
        "ç±»å‹ä¸åŒ¹é…",
        "ä½œç”¨åŸŸé—®é¢˜",
        "æµ…æ‹·è´vsæ·±æ‹·è´",
        "ç¼–ç é—®é¢˜",
        "è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜",
        "æ—¶åŒºé—®é¢˜"
    ]
    
    DEBUGGING_STEPS = [
        "1. ä»”ç»†é˜…è¯»é”™è¯¯ä¿¡æ¯",
        "2. æ£€æŸ¥æœ€è¿‘çš„ä»£ç å˜æ›´",
        "3. ç¡®è®¤è¾“å…¥æ•°æ®çš„æ­£ç¡®æ€§",
        "4. éªŒè¯å‡½æ•°çš„å‰ç½®æ¡ä»¶",
        "5. æ£€æŸ¥è¾¹ç•Œæ¡ä»¶",
        "6. æ·»åŠ æ—¥å¿—è¾“å‡ºå…³é”®å˜é‡",
        "7. ä½¿ç”¨è°ƒè¯•å™¨å•æ­¥æ‰§è¡Œ",
        "8. ç¼–å†™æµ‹è¯•ç”¨ä¾‹éªŒè¯ä¿®å¤"
    ]
    
    @classmethod
    def print_checklist(cls):
        """æ‰“å°è°ƒè¯•æ¸…å•"""
        print("=== å¸¸è§Bugç±»å‹ ===")
        for i, bug in enumerate(cls.COMMON_BUGS, 1):
            print(f"{i}. {bug}")
        
        print("\n=== è°ƒè¯•æ­¥éª¤ ===")
        for step in cls.DEBUGGING_STEPS:
            print(step)

# æµ‹è¯•è°ƒè¯•å·¥å…·
if __name__ == "__main__":
    print("=== è°ƒè¯•ç­–ç•¥ä¸å®è·µ ===")
    
    # æ‰“å°è°ƒè¯•æ¸…å•
    DebuggingChecklist.print_checklist()
    
    # æ¼”ç¤ºè°ƒè¯•ç­–ç•¥
    print("\n" + "="*50)
    DebuggingStrategy.binary_search_debugging()
    DebuggingStrategy.rubber_duck_debugging()
    DebuggingStrategy.minimum_reproducible_example()
```

### ğŸ” æœ¬èŠ‚å°ç»“

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ï¼š

1. **è°ƒè¯•æ–¹æ³•è®º**ï¼šä»è§‚å¯Ÿç°è±¡åˆ°è§£å†³é—®é¢˜çš„ç³»ç»Ÿæ€§æ–¹æ³•
2. **åŸºç¡€è°ƒè¯•æŠ€æœ¯**ï¼šprintè°ƒè¯•ã€æ–­è¨€è°ƒè¯•ã€äº¤äº’å¼è°ƒè¯•
3. **é«˜çº§è°ƒè¯•å·¥å…·**ï¼šloggingæ¨¡å—ã€å¼‚å¸¸è¿½è¸ªã€æ€§èƒ½åˆ†æ
4. **è°ƒè¯•ç­–ç•¥**ï¼šäºŒåˆ†æŸ¥æ‰¾ã€æ©¡çš®é¸­è°ƒè¯•ã€æœ€å°å¯å¤ç°ç¤ºä¾‹

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- è°ƒè¯•æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œéœ€è¦é€»è¾‘æ€ç»´å’Œè€å¿ƒ
- é€‰æ‹©åˆé€‚çš„è°ƒè¯•å·¥å…·å’Œæ–¹æ³•æé«˜æ•ˆç‡
- æ—¥å¿—ç³»ç»Ÿæ˜¯ç”Ÿäº§ç¯å¢ƒè°ƒè¯•çš„é‡è¦å·¥å…·
- è‰¯å¥½çš„è°ƒè¯•ä¹ æƒ¯èƒ½æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡

ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å­¦ä¹ æ—¥å¿—ç³»ç»Ÿçš„è¯¦ç»†é…ç½®å’Œåº”ç”¨ã€‚

--- 